:root{
  --bg: #0f1216;
  --panel: #141922;
  --card: #171c26;
  --muted: #8b98a5;
  --text: #e7edf3;
  --accent: #5aa9ff;
  --accent-2: #7bd389;
  --border: #243042;
  --shadow: 0 6px 24px rgba(0,0,0,.25);
  --radius: 14px;
  --radius-sm: 10px;
  --radius-lg: 20px;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body.app{
  margin: 0;
  background: radial-gradient(1200px 600px at 10% -10%, #1a2333, transparent), var(--bg);
  color: var(--text);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
}

/* Top bar */
.topbar{
  position: sticky; top: 0; z-index: 20;
  display: flex; align-items: center; gap: .75rem;
  height: 56px; padding: 0 12px 0 8px;
  background: rgba(15,18,22,.7);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid rgba(255,255,255,.05);
}
.brand{ font-weight: 600; letter-spacing:.2px; }
.spacer{ flex:1; }

/* Buttons / Inputs */
.btn{
  border: 1px solid var(--border);
  background: #1a2130;
  color: var(--text);
  padding: .45rem .8rem;
  line-height: 1;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 1px 0 rgba(255,255,255,.04) inset;
}
.btn:hover{ background:#20283a; }
.btn.primary{ background: linear-gradient(180deg, #2a7cff, #195bdb); border-color:#184db7; }
.btn.primary:hover{ filter: brightness(1.05); }
.btn.subtle{ background: #161c27; }
.btn.ghost{ background: transparent; border-color: transparent; }
.btn.ghost:hover{ background: rgba(255,255,255,.06); }

.input, .textarea{
  width: 100%;
  color: var(--text);
  background: #0f141d;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: .7rem .8rem;
  outline: none;
}
.textarea:focus, .input:focus{
  border-color: #2b6bff;
  box-shadow: 0 0 0 2px rgba(43,107,255,.15);
}
.textarea.rounded{ border-radius: 999px; padding:.85rem 1rem; resize: none; }

/* Layout */
.layout{
  display: grid;
  grid-template-columns: 280px 1fr;
  min-height: calc(100vh - 56px);
}

/* Drawer */
.drawer-toggle{ position: absolute; left: -9999px; }
.sidebar{
  background: var(--panel);
  border-right: 1px solid var(--border);
  overflow: hidden auto;
  transform: translateX(-100%);
  transition: transform .25s ease;
  will-change: transform;
  position: relative;
  z-index: 19;
}
.drawer-toggle:checked ~ .layout .sidebar{
  transform: translateX(0);
}

.content{
  padding: 20px;
  display: grid;
  grid-template-rows: auto 1fr;
  gap: 16px;
}

/* Sidebar internals */
.sidebar-header{
  position: sticky; top: 0;
  display:flex; align-items:center; gap:.5rem;
  padding: 12px 12px;
  background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,0));
  backdrop-filter: blur(4px);
  z-index: 1;
}
.sidebar .close{ margin-left: auto; }
.sessions{ padding: 8px 12px 12px; }
.sessions ul{ list-style: none; margin: 0; padding: 0; display: grid; gap: 8px; }
.session-item{
  padding: 10px 10px;
  background: #0d1320;
  border: 1px solid var(--border);
  border-radius: 12px;
  position: relative;
}
.session-item.active{
  border-color: #2b6bff;
  box-shadow: 0 0 0 1px rgba(43,107,255,.25) inset;
}
.session-item.active::before{
  content:"";
  position: absolute; left:-1px; top:-1px; bottom:-1px; width: 4px;
  background: linear-gradient(180deg, #2b6bff, #7bd389);
  border-top-left-radius: 12px; border-bottom-left-radius: 12px;
}
.session-link{ color: #cfe1ff; text-decoration: none; font-weight: 550; }
.session-link:hover{ text-decoration: underline; }
.session-meta{ color: var(--muted); font-size: 12px; margin-top: 2px; }
.new-session{ padding: 12px; border-top: 1px dashed var(--border); }
.new-session h4{ margin: 8px 0 10px 0; }

/* Cards */
.card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  display: flex; flex-direction: column;
  min-width: 0;
}
.card-header{
  display: flex; align-items: baseline; gap: 10px;
  padding: 14px 16px; border-bottom: 1px solid var(--border);
}
.card-title{ font-weight: 650; }
.card-subtitle{ color: var(--muted); font-size: 13px; }
.card-actions{ margin-left: auto; display:flex; gap: .5rem; }
.card-body{ padding: 12px 16px; }
.card-footer{ padding: 10px 16px; border-top: 1px solid var(--border); }
.truncate{ overflow:hidden; text-overflow: ellipsis; white-space: nowrap; }

/* Collapsible (details/summary) */
.collapsible details{ overflow:hidden; border-radius: var(--radius); }
.collapsible summary{ list-style:none; cursor:pointer; }
.collapsible summary::-webkit-details-marker{ display:none; }
.collapsible .as-summary{ display:flex; align-items:baseline; gap:10px; }
.collapsible details[open] .as-summary{ border-bottom:1px solid var(--border); }

/* Chat */
.chat{ display: grid; grid-template-rows: auto 1fr auto; min-height: 60vh; }
.chatbox{
  padding: 14px 16px;
  overflow: auto;
  max-height: calc(100vh - 56px - 220px);
}
.msg{ margin: 8px 0; display:flex; }
.msg.user{ justify-content: flex-end; }
.bubble{
  max-width: min(720px, 72%);
  padding: .7rem .9rem;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.06);
  background: #0c1220;
  line-height: 1.35;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.msg.user .bubble{
  background: linear-gradient(180deg, #1a3c7a, #122b5a);
  border-color: rgba(86,120,235,.35);
}
.msg.assistant .bubble{ background: #101724; }
.msg.system .bubble{ background: #1e1a0f; color:#f5e6bf; }

/* Chat input */
.chat-input{
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 10px;
  padding: 12px 12px 14px 12px;
  border-top: 1px solid var(--border);
}
.chat-input .textarea.rounded{ height: 48px; }

/* HTMX indicator (loading) */
.htmx-indicator{ display:none; font-size: 12px; color: var(--muted); align-items:center; }
.htmx-request .htmx-indicator{ display:inline-flex; }
.row{ display:flex; align-items:center; gap:.6rem; }

/* Scrollbars */
.chatbox::-webkit-scrollbar{ width: 10px; }
.chatbox::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.08); border-radius: 8px; }

/* Rename popover */
.rename-wrap{ position: relative; }
.rename-form{
  position: absolute; right: 0; top: calc(100% + 6px);
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  min-width: 260px;
  box-shadow: var(--shadow);
  z-index: 30;
}

/* Make both textareas feel bigger & clearer */
.textarea, .input { font-size: 16.5px; line-height: 1.3; }
.textarea.lg, .input.lg { font-size: 18px; }
.textarea::placeholder { color: var(--muted); opacity: .9; }

/* Make the chat input a little taller when rounded */
.chat-input .textarea.rounded { height: 56px; }

/* Typing indicator bubble (three animated dots) */
.bubble.typing { opacity: .9; }
.typing .dots { display: inline-flex; gap: 6px; align-items: center; }
.typing .dots span {
  width: 6px; height: 6px; border-radius: 50%;
  display: inline-block; background: #cfd6e4;
  animation: paie-dot 1.2s infinite ease-in-out;
}
.typing .dots span:nth-child(2){ animation-delay: .2s; }
.typing .dots span:nth-child(3){ animation-delay: .4s; }

@keyframes paie-dot {
  0%, 80%, 100% { opacity: .25; transform: translateY(0); }
  40% { opacity: 1; transform: translateY(-2px); }
}
